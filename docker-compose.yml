version: "3.3"

networks:
  pdc:
    driver: overlay

services:

  traefik:
    image: "traefik:v2.2"
    hostname: traefik
    command:
      #- "--log.level=DEBUG"
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
    networks:
      - pdc

  authorizator:
   image: "pdc/authorizator"
   hostname: authorizator
   environment:
    SERVICE_PATH: authorizator/
    HOST: localhost
    SECRET_KEY: "&=3^m(bgkt708(&5$gjx_#rnz%_e+zzenmh&#jc!7k=9&a^(+z"
   volumes:
    - ./authorizator:/authorizator
    - ./pdc_dev/pdc:/usr/local/lib/python3.9/site-packages/pdc
   labels:
     - "traefik.enable=true"
     - "traefik.http.routers.authorizator.entrypoints=web"
     - "traefik.http.services.authorizator.loadbalancer.server.port=80"
     - "traefik.http.routers.authorizator.rule=PathPrefix(`/authorizator`)"
   networks:
     - pdc
     
  mariadb:
   image: mariadb
   hostname: mariadb
   volumes:
    - ./db:/var/lib/mysql
   environment:
    MYSQL_ROOT_PASSWORD: pdc_dev
   networks:
     - pdc
     
# for visually manage db

  adminer:
   image: adminer
   ports:
    - 8081:8080
   networks:
     - pdc
